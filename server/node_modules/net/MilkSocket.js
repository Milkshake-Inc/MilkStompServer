var util = require('util');
var EventEmitter = require('events').EventEmitter;
var shortId = require('shortid');

function MilkSocket(socket) {
	EventEmitter.call(this);
	this.socket = socket;
	this.guid = shortId.generate();

	this.socket.on('data', function(data) {
		this.emit('data', data);
	}).bind(this);

	this.socket.on('error', function(data) {
		console.log('Received error: ' + data);
		this.emit('close');
	}).bind(this);

	this.socket.on('close', function() {
		console.log('Closing connection for ' + this.guid);
		this.emit('close');
	}).bind(this);
}

MilkSocket.prototype.write = function(event, data) {
	this.socket.emit(event, data);
};

MilkSocket.prototype.destroy = function destroy() {
	this.socket.destroy();
};

util.inherits(MilkSocket, EventEmitter);
module.exports = MilkSocket;