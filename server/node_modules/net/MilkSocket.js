var util = require('util');
var EventEmitter = require('events').EventEmitter;
var shortId = require('shortid');

function MilkSocket(socket) {
	EventEmitter.call(this);
	this.socket = socket;
	this.guid = shortId.generate();

	this.socket.on('data', (function (data) {
		this.emit('data', data);
	}).bind(this));

	this.socket.on('error', (function (error) {
		console.log('Received error: ' + error);
		console.log(error.stack);
		this.emit('close');
	}).bind(this));

	this.socket.on('disconnect', (function () {
		this.emit('close');
	}).bind(this));
}

util.inherits(MilkSocket, EventEmitter);

MilkSocket.prototype.write = function (data) {
	this.socket.emit('data', data);
};

module.exports = MilkSocket;